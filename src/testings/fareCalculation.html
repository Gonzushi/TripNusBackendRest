<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fare Estimator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Mapbox CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet">
  <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
    }
    #fareResult {
      margin-top: 20px;
      padding: 12px;
      background: #f9f9f9;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>

  <h2>Fare Estimator</h2>

  <label for="pickup">Pickup Point:</label>
  <div id="pickup" style="margin-bottom: 10px;"></div>

  <label for="dropoff">Destination:</label>
  <div id="dropoff" style="margin-bottom: 10px;"></div>

  <button onclick="calculateFare()">Check Fare</button>

  <div id="fareResult"></div>

  <!-- Mapbox JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiaGVuZHJ5d2lkeWFudG8iLCJhIjoiY21iMGxnNTE0MHJ4NzJqcDc0djdjbjh1eSJ9.48jCVoCZElJEsw5p59C0_w'; // Replace with your token

    let pickupCoords = null;
    let dropoffCoords = null;

    const pickupGeocoder = new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      placeholder: "Enter pickup location",
      marker: false,
    });
    pickupGeocoder.addTo('#pickup');
    pickupGeocoder.on('result', e => {
      pickupCoords = e.result.geometry.coordinates;
    });

    const dropoffGeocoder = new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      placeholder: "Enter destination",
      marker: false,
    });
    dropoffGeocoder.addTo('#dropoff');
    dropoffGeocoder.on('result', e => {
      dropoffCoords = e.result.geometry.coordinates;
    });

    async function calculateFare() {
      const resultDiv = document.getElementById("fareResult");
      resultDiv.innerHTML = "";

      if (!pickupCoords || !dropoffCoords) {
        resultDiv.innerHTML = "Please select both pickup and destination.";
        return;
      }

      try {
        const response = await fetch('https://yourdomain.com/fare/calculate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            pickpoint: pickupCoords,
            dropoff: dropoffCoords
          })
        });

        const data = await response.json();

        if (!response.ok) throw new Error(data.error || "Unknown error");

        resultDiv.innerHTML = `
          <strong>Car Fare:</strong> Rp${data.fare.car.total_fare.toLocaleString()}<br>
          <strong>Motorcycle Fare:</strong> Rp${data.fare.motorcycle.total_fare.toLocaleString()}<br>
          <br>
          <small><i>Distance:</i> ${(data.distance / 1000).toFixed(2)} km<br>
          <i>Duration:</i> ${(data.duration / 60).toFixed(1)} mins</small>
        `;
      } catch (err) {
        resultDiv.innerHTML = `Error: ${err.message}`;
      }
    }
  </script>
</body>
</html>
